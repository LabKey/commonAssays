<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

    <bean id="ms2PipelineRegistry" class="org.labkey.api.pipeline.TaskPipelineRegistrar">
        <property name="pipelines">
            <list>
                <!-- X! Tandem search pipeline -->
                <bean class="org.labkey.api.pipeline.TaskPipelineSettings">
                    <constructor-arg type="java.lang.Class" value="org.labkey.ms2.pipeline.tandem.XTandemPipelineJob"/>
                    <property name="protocolObjectId" value="MS2.XTandemSearch" />
                    <property name="protocolName" value="X!Tandem analysis" />
                    <property name="taskProgressionSpec">
                        <list>
                            <value type="java.lang.Class">org.labkey.ms2.pipeline.FastaCheckTask</value>
                            <ref bean="mzxmlConverter"/>
                            <value type="java.lang.Class">org.labkey.ms2.pipeline.tandem.XTandemSearchTask</value>
                            <ref bean="tppTask"/>
                            <ref bean="expGeneratorSearch"/>
                            <ref bean="tppTaskJoin"/>
                            <ref bean="expGeneratorSearchJoin"/>
                        </list>
                    </property>
                </bean>

                <!-- Mascot search pipelines -->
                <bean class="org.labkey.api.pipeline.TaskPipelineSettings">
                    <constructor-arg type="java.lang.Class" value="org.labkey.ms2.pipeline.mascot.MascotPipelineJob"/>
                    <property name="protocolObjectId" value="MS2.MascotSearch" />
                    <property name="protocolName" value="Mascot analysis" />
                    <property name="taskProgressionSpec">
                        <list>
                            <value type="java.lang.Class">org.labkey.ms2.pipeline.FastaCheckTask</value>
                            <ref bean="mzxmlConverter"/>
                            <value type="java.lang.Class">org.labkey.ms2.pipeline.mascot.MascotSearchTask</value>
                            <ref bean="tppTask"/>
                            <ref bean="expGeneratorSearch"/>
                            <ref bean="tppTaskJoin"/>
                            <ref bean="expGeneratorSearchJoin"/>
                        </list>
                    </property>
                </bean>

                <!-- Sequest search pipelines -->
                <bean class="org.labkey.api.pipeline.TaskPipelineSettings">
                    <constructor-arg type="java.lang.Class" value="org.labkey.ms2.pipeline.sequest.SequestPipelineJob"/>
                    <property name="protocolObjectId" value="MS2.SequestSearch" />
                    <property name="protocolName" value="Sequest analysis" />
                    <property name="taskProgressionSpec">
                        <list>
                            <value type="java.lang.Class">org.labkey.ms2.pipeline.FastaCheckTask</value>
                            <ref bean="mzxmlConverter"/>
                            <value type="java.lang.Class">org.labkey.ms2.pipeline.sequest.SequestSearchTask</value>
                            <ref bean="tppTask"/>
                            <ref bean="expGeneratorSearch"/>
                            <ref bean="tppTaskJoin"/>
                            <ref bean="expGeneratorSearchJoin"/>
                        </list>
                    </property>
                </bean>

                <!-- MS2 pipeline for finishing a search on the Perl Cluster Pipeline -->
                <bean class="org.labkey.api.pipeline.TaskPipelineSettings">
                    <constructor-arg type="java.lang.Class" value="org.labkey.ms2.pipeline.AbstractMS2SearchPipelineJob"/>
                    <constructor-arg value="finishPerlCluster"/>
                    <property name="taskProgressionSpec">
                        <list>
                            <ref bean="expTemplateSearch"/>
                            <ref bean="expImportSearch"/>
                        </list>
                    </property>
                </bean>

                <!-- MS2 pipeline for finishing a fractions search on the Perl Cluster Pipeline -->
                <bean class="org.labkey.api.pipeline.TaskPipelineSettings">
                    <constructor-arg type="java.lang.Class" value="org.labkey.ms2.pipeline.AbstractMS2SearchPipelineJob"/>
                    <constructor-arg value="finishPerlClusterJoined"/>
                    <property name="taskProgressionSpec">
                        <list>
                            <ref bean="expTemplateSearchJoin"/>
                            <ref bean="expImportSearchJoin"/>
                        </list>
                    </property>
                </bean>
            </list>
        </property>
        <property name="factoryImpls">
            <list>
                <bean class="org.labkey.ms2.pipeline.FastaCheckTask$Factory"/>
                <bean class="org.labkey.ms2.pipeline.tandem.XTandemSearchTask$Factory"/>
                <bean class="org.labkey.ms2.pipeline.mascot.MascotSearchTask$Factory"/>
                <bean class="org.labkey.ms2.pipeline.sequest.SequestSearchTask$Factory"/>
                <bean class="org.labkey.ms2.pipeline.TPPTask$Factory"/>
                <bean class="org.labkey.ms2.pipeline.TPPTask$FactoryJoin"/>
            </list>
        </property>
        <property name="factories">
            <list>
                <ref bean="readwMzxmlConverter"/>
            </list>
        </property>
    </bean>

    <bean id="tppTask" class="org.labkey.api.pipeline.TaskId">
        <constructor-arg><value type="java.lang.Class">org.labkey.ms2.pipeline.TPPTask</value></constructor-arg>
    </bean>

    <bean id="tppTaskJoin" class="org.labkey.api.pipeline.TaskId">
        <constructor-arg><value type="java.lang.Class">org.labkey.ms2.pipeline.TPPTask</value></constructor-arg>
        <constructor-arg value="join"/>
    </bean>

    <bean id="expGeneratorSearch" class="org.labkey.api.exp.pipeline.XarGeneratorFactorySettings">
        <constructor-arg value="expGeneratorSearch"/>
        <property name="outputExt" value=".search.xar.xml"/>
        <property name="dependencyId" ref="tppTask"/>
    </bean>

    <bean id="expGeneratorSearchJoin" class="org.labkey.api.exp.pipeline.XarGeneratorFactorySettings">
        <constructor-arg value="expGeneratorSearchJoin"/>
        <property name="outputExt" value=".search.xar.xml"/>
        <property name="join" value="true" />
        <property name="dependencyId" ref="tppTaskJoin"/>
    </bean>

    <bean id="expTemplateSearch" class="org.labkey.api.exp.pipeline.XarTemplateSubstitutionFactorySettings">
        <constructor-arg value="expTemplateSearch"/>
        <property name="outputExt" value=".search.xar.xml"/>
        <property name="dependencyId" ref="tppTask"/>
    </bean>

    <bean id="expTemplateSearchJoin" class="org.labkey.api.exp.pipeline.XarTemplateSubstitutionFactorySettings">
        <constructor-arg value="expTemplateSearchJoin"/>
        <property name="outputExt" value=".search.xar.xml"/>
        <property name="join" value="true"/>
        <property name="dependencyId" ref="tppTaskJoin"/>
    </bean>

    <bean id="expImportSearch" class="org.labkey.api.exp.pipeline.XarImportFactorySettings">
        <constructor-arg value="expImportSearch"/>
        <property name="inputExt" value=".search.xar.xml"/>
        <property name="dependencyId" ref="tppTask"/>
    </bean>

    <bean id="expImportSearchJoin" class="org.labkey.api.exp.pipeline.XarImportFactorySettings">
        <constructor-arg value="expImportSearchJoin"/>
        <property name="inputExt" value=".search.xar.xml"/>
        <property name="join" value="true"/>
        <property name="dependencyId" ref="tppTaskJoin"/>
    </bean>

    <bean id="mzxmlConverter" class="org.labkey.api.pipeline.cmd.ConvertTaskFactorySettings">
        <constructor-arg value="mzxmlConverter"/>
        <property name="statusName" value="MZXML CONVERSION"/>
        <property name="outputExt" value=".mzXML"/>
        <!-- Add converters in ms2Config.xml to enable -->
    </bean>

    <bean id="unixNewSwitch" class="org.labkey.api.pipeline.cmd.UnixNewSwitchFormat"/>

    <bean id="readwMzxmlConverter" class="org.labkey.api.pipeline.cmd.CommandTaskFactorySettings">
        <constructor-arg value="readwMzxmlConverter"/>
        <property name="statusName" value="MZXML CONVERSION"/>
        <property name="groupParameterName" value="readw" />
        <property name="protocolActionName" value="ReAdW mzXML Conversion" />
        <property name="outputExtension" value=".mzXML"/>
        <property name="inputPaths">
            <map>
                <entry key="input">
                    <bean class="org.labkey.api.pipeline.cmd.TaskPath">
                        <constructor-arg value=".RAW"/>
                        <property name="role" value="mzXML" />
                    </bean>
                </entry>
            </map>
        </property>
        <property name="converters">
            <list>
                <bean class="org.labkey.api.pipeline.cmd.RequiredInLine">
                    <property name="value" value="ReAdW"/>
                </bean>
                <bean class="org.labkey.api.pipeline.cmd.EnumToCommandArgs">
                    <property name="parameter" value="pipeline, readw version"/>
                    <property name="default" value="3.5.1"/>
                    <property name="converters">
                        <map>
                            <entry key="3.5.1">
                                <bean class="org.labkey.api.pipeline.cmd.ListToCommandArgs">
                                    <property name="switchFormat" ref="unixNewSwitch"/>
                                    <property name="converters">
                                        <list>
                                            <bean class="org.labkey.api.pipeline.cmd.RequiredSwitch">
                                                <property name="switchName" value="mzxml"/>
                                            </bean>
                                            <bean class="org.labkey.api.pipeline.cmd.BooleanToSwitch">
                                                <property name="parameter" value="readw, use compression"/>
                                                <property name="switchName" value="compress"/>
                                            </bean>
                                            <bean class="org.labkey.api.pipeline.cmd.BooleanToSwitch">
                                                <property name="parameter" value="readw, verbose"/>
                                                <property name="switchName" value="verbose"/>
                                            </bean>
                                            <bean class="org.labkey.api.pipeline.cmd.PathInLine"/>
                                            <bean class="org.labkey.api.pipeline.cmd.PathInLine">
                                                <property name="function" value="output"/>
                                            </bean>
                                        </list>
                                    </property>
                                </bean>
                            </entry>
<!--                            <entry key="1.0">
                                <bean class="org.labkey.api.pipeline.cmd.ListToCommandArgs">

                                </bean>                                
                            </entry> -->
                        </map>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

</beans>